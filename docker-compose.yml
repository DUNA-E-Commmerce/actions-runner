services:
  actions-runner:
    platform: linux/amd64
    build:
      context: .
      dockerfile: Dockerfile
    container_name: actions-runner-local
    privileged: true
    cap_add:
      - SYS_ADMIN
    security_opt:
      - seccomp=unconfined
      - apparmor=unconfined
    volumes:
      - /sys/fs/cgroup:/sys/fs/cgroup:rw
      - docker-data:/var/lib/docker
      - ./test-workspace:/workspace
      - ./logs:/var/log
    environment:
      - DOCKER_TLS_CERTDIR=
      - RUNNER_NAME=local-test-runner
      - RUNNER_WORK_DIRECTORY=/workspace
    ports:
      # Docker daemon TCP port (para debug)
      - "2376:2376"
    # Comando por defecto para iniciar dockerd
    command: ["/home/runner/run.sh"]
    networks:
      - runner-network
volumes:
  docker-data:
    driver: local

networks:
  runner-network:
    driver: bridge